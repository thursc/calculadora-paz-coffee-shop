<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculadora de Custos - Paz Coffee Shop</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Custom scrollbar */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: #f97316; border-radius: 10px; }
        ::-webkit-scrollbar-thumb:hover { background: #ea580c; }
        .bonus-highlight, .shift-item { transition: all 0.3s ease-in-out; }
        label:has(input:disabled) { opacity: 0.5; cursor: not-allowed; }
        .event-item.disabled { opacity: 0.6; background-color: #f9fafb; }
        /* Hide number input arrows */
        input[type=number]::-webkit-inner-spin-button,
        input[type=number]::-webkit-outer-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        input[type=number] {
            -moz-appearance: textfield;
        }
        details > summary {
            list-style: none;
        }
        details > summary::-webkit-details-marker {
            display: none;
        }
        .modal {
            transition: opacity 0.25s ease;
        }
        details[open] > summary {
            border-bottom-left-radius: 0;
            border-bottom-right-radius: 0;
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800">

    <div class="container mx-auto p-4 md:p-8">
        <header class="text-center mb-8">
            <!-- LOGO SVG UPDATED -->
            <svg version="1.0" xmlns="http://www.w3.org/2000/svg"
                 viewBox="0 0 2434 2434"
                 preserveAspectRatio="xMidYMid meet"
                 class="w-full max-w-[120px] md:max-w-[132px] mx-auto h-auto" style="color: #373435;">
                <g transform="translate(0.000000,2434.000000) scale(0.100000,-0.100000)"
                fill="currentColor" stroke="none">
                <path d="M11774 24329 c-2503 -80 -4898 -921 -6899 -2423 -477 -358 -865 -695
                -1305 -1136 -441 -440 -778 -828 -1136 -1305 -2095 -2792 -2883 -6327 -2178
                -9768 381 -1859 1220 -3641 2416 -5129 303 -377 539 -640 898 -998 440 -441
                828 -778 1305 -1136 2719 -2040 6144 -2842 9510 -2228 1959 358 3828 1213
                5387 2466 601 482 1191 1055 1670 1621 2339 2762 3322 6348 2722 9922 -340
                2023 -1206 3952 -2496 5557 -482 601 -1055 1191 -1621 1670 -1735 1469 -3788
                2408 -6017 2752 -491 76 -957 118 -1505 136 -326 11 -404 11 -751 -1z m956
                -879 c1887 -98 3658 -637 5265 -1603 190 -114 627 -404 810 -537 1730 -1262
                3058 -2967 3853 -4945 462 -1151 723 -2347 792 -3635 22 -408 11 -1046 -25
                -1495 -256 -3142 -1821 -6031 -4325 -7982 -238 -186 -411 -310 -695 -498 -419
                -278 -711 -448 -1160 -675 -1290 -651 -2687 -1045 -4135 -1164 -594 -49 -1286
                -49 -1880 0 -1729 142 -3392 679 -4885 1577 -193 116 -630 406 -810 537 -882
                644 -1663 1405 -2323 2262 -1323 1720 -2121 3784 -2297 5943 -49 604 -49 1266
                0 1870 256 3142 1821 6031 4325 7982 235 183 409 308 695 498 417 276 710 447
                1160 675 1391 703 2912 1106 4485 1189 228 12 925 12 1150 1z"/>
                <path d="M5980 15670 l0 -2950 755 0 755 0 0 754 0 755 668 4 c728 4 747 5
                999 67 578 140 1035 513 1303 1064 148 303 223 615 237 976 29 803 -324 1547
                -920 1943 -231 153 -478 250 -787 309 -115 22 -120 22 -1562 25 l-1448 4 0
                -2951z m2750 1586 c211 -70 357 -228 433 -471 39 -123 50 -228 44 -394 -6
                -158 -26 -256 -78 -383 -86 -210 -237 -357 -414 -403 -50 -13 -151 -15 -642
                -15 l-583 0 0 846 0 845 593 -3 c540 -4 597 -5 647 -22z"/>
                <path d="M10937 15300 l-1107 -2400 0 -90 0 -90 614 0 613 0 144 310 144 310
                970 0 970 0 144 -310 144 -310 2513 0 2514 0 0 560 0 560 -1015 0 c-558 0
                -1015 4 -1015 8 0 5 452 817 1005 1805 l1005 1796 0 91 0 90 -1860 0 -1860 0
                0 -560 0 -560 911 0 c501 0 909 -4 907 -8 -1 -5 -437 -788 -968 -1740 -628
                -1126 -968 -1727 -973 -1719 -5 6 -492 1056 -1082 2332 l-1073 2320 -269 3
                -269 2 -1107 -2400z m1663 -256 l276 -629 -277 -3 c-153 -1 -405 -1 -561 0
                l-284 3 275 643 c192 447 279 639 285 629 5 -8 133 -297 286 -643z"/>
                <path d="M9505 12054 c-522 -52 -903 -346 -1048 -810 -78 -249 -75 -591 8
                -841 66 -196 146 -324 294 -465 391 -374 1028 -433 1514 -141 166 100 337 293
                422 475 127 277 151 650 60 962 -120 414 -454 710 -895 796 -96 19 -281 31
                -355 24z m249 -600 c208 -53 366 -214 421 -429 42 -165 25 -356 -45 -503 -172
                -361 -654 -442 -937 -157 -123 125 -174 263 -174 471 0 173 32 282 117 401 75
                104 197 187 322 217 78 20 221 19 296 0z"/>
                <path d="M6775 12029 c-705 -109 -1117 -712 -990 -1444 98 -563 576 -945 1182
                -945 558 0 963 293 1089 788 38 148 70 132 -269 132 l-293 0 -18 -50 c-56
                -157 -183 -268 -356 -311 -85 -21 -232 -17 -315 9 -271 83 -445 369 -421 693
                28 376 283 618 626 595 212 -14 363 -108 441 -274 l34 -72 294 0 293 0 -7 48
                c-11 71 -53 199 -93 277 -141 282 -386 462 -737 541 -83 19 -372 27 -460 13z"/>
                <path d="M11267 12013 c-4 -3 -7 -534 -7 -1180 l0 -1173 305 0 305 0 0 385 0
                385 380 0 380 0 0 265 0 265 -380 0 -380 0 0 260 0 260 430 0 430 0 -2 268 -3
                267 -726 3 c-399 1 -729 -1 -732 -5z"/>
                <path d="M13190 10840 l0 -1180 305 0 305 0 0 385 0 385 380 0 380 0 0 265 0
                265 -380 0 -380 0 0 260 0 260 425 0 425 0 0 270 0 270 -730 0 -730 0 0 -1180z"/>
                <path d="M15120 10840 l0 -1180 750 0 750 0 0 265 0 265 -452 2 -453 3 -3 207
                -2 208 402 2 403 3 3 262 2 263 -402 2 -403 3 -3 168 -2 167 440 0 440 0 -2
                268 -3 267 -732 3 -733 2 0 -1180z"/>
                <path d="M17137 12013 c-4 -3 -7 -534 -7 -1180 l0 -1173 750 0 750 0 0 265 0
                265 -450 0 -450 0 0 210 0 210 400 0 400 0 0 265 0 265 -400 0 -400 0 0 170 0
                170 435 0 435 0 0 270 0 270 -728 0 c-401 0 -732 -3 -735 -7z"/>
                <path d="M5720 7425 l0 -1705 6445 0 6445 0 0 1705 0 1705 -6445 0 -6445 0 0
                -1705z m2049 1080 c106 -18 242 -66 327 -116 96 -56 195 -162 243 -260 39 -79
                70 -196 71 -271 l0 -28 -259 0 -258 0 -7 40 c-9 58 -76 123 -147 144 -71 22
                -200 20 -266 -3 -111 -38 -165 -98 -166 -184 -1 -67 23 -108 82 -140 64 -35
                99 -42 321 -71 335 -43 484 -94 603 -206 35 -32 75 -81 90 -109 42 -77 67
                -189 67 -302 0 -196 -45 -307 -180 -441 -75 -74 -102 -93 -191 -137 -184 -89
                -388 -124 -594 -103 -256 27 -461 120 -595 269 -87 98 -150 253 -150 370 l0
                53 260 0 259 0 10 -38 c14 -49 61 -94 136 -129 57 -26 68 -28 200 -28 139 0
                141 0 208 33 80 39 107 75 107 140 0 121 -94 168 -380 192 -308 25 -478 86
                -613 218 -115 112 -162 258 -154 472 5 150 26 216 99 326 162 243 516 367 877
                309z m5886 0 c304 -49 560 -209 720 -449 65 -98 115 -213 147 -341 20 -79 23
                -115 23 -295 0 -179 -3 -216 -23 -293 -102 -405 -368 -670 -781 -778 -99 -26
                -336 -36 -452 -19 -255 37 -514 176 -664 357 -168 202 -245 433 -245 733 0
                246 50 438 161 615 220 354 667 543 1114 470z m-3565 -400 l0 -385 325 0 325
                0 2 383 3 382 278 3 277 2 0 -1065 0 -1065 -277 2 -278 3 -3 423 -2 422 -325
                0 -325 0 0 -425 0 -425 -275 0 -275 0 0 1065 0 1065 275 0 275 0 0 -385z
                m6650 362 c279 -65 469 -253 553 -545 29 -103 31 -343 4 -441 -43 -158 -102
                -264 -202 -365 -82 -83 -169 -137 -277 -171 -109 -34 -213 -45 -445 -45 l-203
                0 0 -270 0 -270 -272 2 -273 3 -3 1050 c-1 578 0 1056 3 1063 8 21 1023 11
                1115 -11z"/>
                <path d="M13330 7974 c-142 -38 -265 -135 -325 -258 -49 -101 -65 -173 -65
                -296 0 -127 19 -210 66 -301 209 -398 807 -351 954 75 103 301 -12 626 -263
                745 -111 52 -252 66 -367 35z"/>
                <path d="M16170 7694 l0 -306 218 4 c202 3 220 5 259 25 84 45 133 148 133
                281 0 111 -21 173 -78 232 -30 31 -61 52 -87 59 -23 6 -127 11 -242 11 l-203
                0 0 -306z"/>
                </g>
            </svg>
            <!-- SUBTITLE UPDATED -->
            <p class="text-xl text-gray-600 mt-2">Calculadora Interativa de<br>Custos de Mão de Obra</p>
        </header>

        <main class="bg-white p-6 rounded-2xl shadow-lg">
            <div class="flex flex-wrap justify-between items-center mb-6 border-b pb-4 gap-4">
                <h2 class="text-2xl font-semibold">Quadro de Funcionários</h2>
                <button id="add-employee" class="bg-orange-500 hover:bg-orange-600 text-white font-bold py-2 px-4 rounded-lg transition-transform transform hover:scale-105">
                    Adicionar Funcionário
                </button>
            </div>

            <div id="employee-container" class="space-y-4">
                <!-- Employee cards will be inserted here -->
            </div>

            <div class="mt-8 pt-6 border-t-2 border-dashed">
                <div class="flex justify-end items-center">
                    <span class="text-2xl font-semibold text-gray-700 mr-4">Custo Total Semanal:</span>
                    <span id="total-cost" class="text-4xl font-bold text-orange-600">R$ 0,00</span>
                </div>
            </div>
        </main>
        
        <footer class="text-center mt-8 text-gray-500 text-sm">
            <p>Desenvolvido para Ruth e a equipe da Paz Coffee Shop.</p>
        </footer>
    </div>
    
    <!-- Holerite Modal -->
    <div id="holerite-modal" class="modal pointer-events-none fixed w-full h-full top-0 left-0 flex items-center justify-center opacity-0">
        <div class="modal-overlay absolute w-full h-full bg-gray-900 opacity-50"></div>
        <div class="modal-container bg-white w-11/12 md:max-w-xl mx-auto rounded-lg shadow-lg z-50 overflow-y-auto">
            <div class="modal-content py-4 text-left px-6">
                <div class="flex justify-between items-center pb-3">
                    <p class="text-2xl font-bold">Demonstrativo de Pagamento</p>
                    <button class="modal-close-btn cursor-pointer z-50 text-3xl">&times;</button>
                </div>
                <div class="my-5">
                    <textarea id="holerite-text" class="w-full h-64 p-2 border border-gray-300 rounded-md bg-gray-50" readonly></textarea>
                </div>
                <div class="flex justify-end pt-2">
                    <button id="copy-holerite-btn" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded">
                        Copiar Texto
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div id="delete-confirm-modal" class="modal pointer-events-none fixed w-full h-full top-0 left-0 flex items-center justify-center opacity-0">
        <div class="modal-overlay absolute w-full h-full bg-gray-900 opacity-50"></div>
        <div class="modal-container bg-white w-11/12 md:max-w-md mx-auto rounded-lg shadow-lg z-50 overflow-y-auto">
            <div class="modal-content py-4 text-left px-6">
                <div class="flex justify-between items-center pb-3">
                    <p class="text-2xl font-bold">Confirmar Exclusão</p>
                    <button class="modal-close-btn cursor-pointer z-50 text-3xl">&times;</button>
                </div>
                <p id="delete-confirm-text" class="my-5">Você tem certeza?</p>
                <div class="flex justify-end pt-2">
                    <button class="modal-close-btn px-4 bg-transparent p-3 rounded-lg text-indigo-500 hover:bg-gray-100 hover:text-indigo-400 mr-2">Cancelar</button>
                    <button id="confirm-delete-btn" class="px-4 bg-red-500 p-3 rounded-lg text-white hover:bg-red-400">Excluir</button>
                </div>
            </div>
        </div>
    </div>


    <template id="employee-template">
        <details class="employee-card-details bg-gray-50 rounded-xl border border-gray-200 shadow-sm" open>
            <!-- SUMMARY NO LONGER TOGGLES THE CARD -->
            <summary class="employee-summary flex justify-between items-center p-4 gap-4 rounded-xl hover:bg-gray-100 transition-colors duration-150">
                <input type="text" class="employee-name text-xl font-semibold bg-transparent focus:bg-white focus:ring-2 focus:ring-orange-500 rounded-md p-2 w-full min-w-0" placeholder="Nome do Funcionário">
                <!-- BUTTONS REORDERED AND MINIMIZE BUTTON ADDED -->
                <div class="flex items-center gap-2 flex-shrink-0">
                    <button class="minimize-btn p-2 rounded-full hover:bg-gray-200" title="Minimizar/Expandir">
                        <!-- Minimize Icon -->
                        <svg class="w-5 h-5 text-gray-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2.5" stroke="currentColor">
                          <path stroke-linecap="round" stroke-linejoin="round" d="M4.5 15.75l7.5-7.5 7.5 7.5" />
                        </svg>
                    </button>
                    <button class="reset-btn p-2 rounded-full hover:bg-gray-200" title="Resetar Turnos e Eventos">
                        <svg class="w-5 h-5 text-gray-600" viewBox="0 0 21 21" xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2">
                            <g transform="translate(2 2)">
                                <path d="m4.5 1.5c-2.4138473 1.37729434-4 4.02194088-4 7 0 4.418278 3.581722 8 8 8s8-3.581722 8-8-3.581722-8-8-8"/>
                                <path d="m4.5 5.5v-4h-4"/>
                            </g>
                        </svg>
                    </button>
                    <!-- DELETE BUTTON UPDATED -->
                    <button class="remove-employee p-2 rounded-full hover:bg-red-100 text-red-500 hover:text-red-700 flex items-center justify-center" title="Excluir Funcionário">
                        <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5">
                          <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
                        </svg>
                    </button>
                </div>
            </summary>
            <div class="employee-content p-5 border-t border-gray-200">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-x-6 gap-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-600 mb-1">Valor/Hora (R$)</label>
                        <input type="text" data-type="currency" class="hourly-rate w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent" value="R$ 15,00">
                    </div>
                </div>

                <div class="space-y-4 mt-4">
                    <div class="shifts-section bg-white rounded-lg p-3 border">
                        <h4 class="text-md font-semibold text-gray-700 mb-2">Turnos Trabalhados</h4>
                        <div class="shifts-container grid grid-cols-1 sm:grid-cols-2 gap-2"></div>
                    </div>

                    <div class="bonus-section bg-white rounded-lg p-3 border">
                        <h4 class="text-md font-semibold text-gray-700 mb-2">Bônus Aplicáveis</h4>
                        <label class="bonus-highlight flex items-center p-2 rounded-lg" data-bonus="dobradinha" title="Adiciona R$ 50,00 ao total">
                            <input type="checkbox" class="bonus-dobradinha-checkbox h-5 w-5 text-orange-600 rounded focus:ring-orange-500 mr-2" disabled>
                            <span class="font-medium">Dobradinha (Dom. M+N)</span>
                        </label>
                    </div>

                    <div class="events-section bg-white rounded-lg p-3 border">
                        <div class="flex justify-between items-center mb-2">
                            <h4 class="text-md font-semibold text-gray-700">Eventos / Adicionais</h4>
                            <button class="add-event-btn bg-blue-500 hover:bg-blue-600 text-white font-bold h-7 w-7 rounded-full flex items-center justify-center text-lg leading-none pb-1 flex-shrink-0">+</button>
                        </div>
                        <div class="event-list space-y-3"></div>
                    </div>
                </div>
                
                <div class="mt-4 pt-4 border-t-2 border-dashed flex justify-between items-center">
                    <button class="generate-holerite-btn bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-lg text-sm">Gerar Holerite</button>
                    <div class="text-right">
                        <span class="text-lg font-medium">Total Funcionário:</span>
                        <span class="employee-total text-2xl font-bold text-green-600 ml-2">R$ 0,00</span>
                    </div>
                </div>

                <details class="calculation-details mt-2 text-right">
                    <summary class="cursor-pointer text-sm text-blue-600 hover:underline inline-block">Ver Detalhes do Cálculo</summary>
                    <div class="details-content mt-2 p-3 bg-gray-100 rounded-md text-sm space-y-3 text-left">
                        <div class="shifts-breakdown-container hidden">
                            <h5 class="font-semibold text-gray-800">Turnos:</h5>
                            <ul class="shifts-breakdown-list list-disc list-inside text-gray-700 pl-2"></ul>
                        </div>
                        <div class="events-breakdown-container hidden">
                            <h5 class="font-semibold text-gray-800">Eventos/Adicionais:</h5>
                            <ul class="events-breakdown-list list-disc list-inside text-gray-700 pl-2"></ul>
                        </div>
                        <div class="bonus-breakdown-container hidden">
                            <h5 class="font-semibold text-gray-800">Bônus:</h5>
                            <ul class="bonus-breakdown-list list-disc list-inside text-gray-700 pl-2"></ul>
                        </div>
                    </div>
                </details>
            </div>
        </details>
    </template>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const employeeContainer = document.getElementById('employee-container');
            const addEmployeeButton = document.getElementById('add-employee');
            const employeeTemplate = document.getElementById('employee-template');
            const totalCostEl = document.getElementById('total-cost');
            
            const holeriteModal = document.getElementById('holerite-modal');
            const deleteConfirmModal = document.getElementById('delete-confirm-modal');
            const holeriteTextarea = document.getElementById('holerite-text');
            const copyHoleriteBtn = document.getElementById('copy-holerite-btn');
            const deleteConfirmText = document.getElementById('delete-confirm-text');
            const confirmDeleteBtn = document.getElementById('confirm-delete-btn');

            let cardToDelete = null;

            const SHIFTS = [
                { id: 'sabado', label: 'Sábado', hours: 7 },
                { id: 'domingo_manha', label: 'Dom. Manhã', hours: 7 },
                { id: 'domingo_noite', label: 'Dom. Noite', hours: 8 },
                { id: 'segunda', label: 'Segunda-feira', hours: 5 }
            ];

            const BONUS_DOBRADINHA_VALUE = 50;
            const STORAGE_KEY = 'pazCoffeeCalculatorData';

            const formatCurrency = (value) => value.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
            
            // *** CORREÇÃO: A função 'formatCurrencyInput' foi removida e substituída por uma nova abordagem. ***

            const parseCurrency = (value) => {
                if (!value) return 0;
                // Esta função agora pode analisar tanto "R$ 1.234,56" quanto "1234,56"
                return parseFloat(String(value).replace('R$', '').replace(/\./g, '').replace(',', '.').trim()) || 0;
            };

            // *** CORREÇÃO: Nova função para lidar com a formatação de moeda de forma mais intuitiva. ***
            const setupCurrencyHandlers = (input) => {
                // 1. Formata o valor inicial do campo.
                const initialValue = parseCurrency(input.value);
                input.value = formatCurrency(initialValue);

                // 2. Ao focar (clicar no campo), remove a formatação para facilitar a edição.
                // Ex: "R$ 50,00" vira "50,00"
                input.addEventListener('focus', (e) => {
                    const numericValue = parseCurrency(e.target.value);
                    if (numericValue !== 0) {
                        e.target.value = numericValue.toFixed(2).replace('.', ',');
                    } else {
                        e.target.value = '';
                    }
                });

                // 3. Ao desfocar (clicar fora), formata o número digitado para o padrão de moeda.
                // Ex: "50,25" vira "R$ 50,25"
                input.addEventListener('blur', (e) => {
                    const numericValue = parseFloat(e.target.value.replace(',', '.')) || 0;
                    e.target.value = formatCurrency(numericValue);
                    // Recalcula tudo para garantir que a mudança seja refletida.
                    calculateAll();
                });
            };


            const saveData = () => {
                const employeesData = [];
                document.querySelectorAll('.employee-card-details').forEach(cardDetails => {
                    const card = cardDetails.querySelector('.employee-content');
                    const shifts = [];
                    card.querySelectorAll('.shift-item').forEach(shiftItem => {
                        shifts.push({
                            id: shiftItem.querySelector('.shift-checkbox').dataset.shift,
                            checked: shiftItem.querySelector('.shift-checkbox').checked,
                            hours: shiftItem.querySelector('.shift-hours').dataset.lastValue
                        });
                    });

                    const events = [];
                    card.querySelectorAll('.event-item').forEach(eventItem => {
                        events.push({
                            name: eventItem.querySelector('.event-name').value,
                            type: eventItem.querySelector('.event-type-selector').value,
                            hours: eventItem.querySelector('.event-hours').value,
                            // Salva o valor já formatado para manter a consistência
                            fixedValue: eventItem.querySelector('.event-fixed-value').value,
                            specificRate: eventItem.querySelector('.event-specific-rate').value,
                            checked: eventItem.querySelector('.event-checkbox').checked
                        });
                    });

                    employeesData.push({
                        id: cardDetails.dataset.id,
                        name: cardDetails.querySelector('.employee-name').value,
                        hourlyRate: card.querySelector('.hourly-rate').value,
                        shifts: shifts,
                        bonusDobradinha: card.querySelector('.bonus-dobradinha-checkbox').checked,
                        events: events,
                        open: cardDetails.open,
                    });
                });
                localStorage.setItem(STORAGE_KEY, JSON.stringify(employeesData));
            };

            const calculateAll = () => {
                let grandTotal = 0;
                document.querySelectorAll('.employee-card-details').forEach(cardDetails => {
                    const card = cardDetails.querySelector('.employee-content');
                    const hourlyRate = parseCurrency(card.querySelector('.hourly-rate').value);
                    
                    const shiftsBreakdownContainer = card.querySelector('.shifts-breakdown-container');
                    const eventsBreakdownContainer = card.querySelector('.events-breakdown-container');
                    const bonusBreakdownContainer = card.querySelector('.bonus-breakdown-container');
                    const shiftsList = card.querySelector('.shifts-breakdown-list');
                    const eventsList = card.querySelector('.events-breakdown-list');
                    const bonusList = card.querySelector('.bonus-breakdown-list');

                    shiftsList.innerHTML = '';
                    eventsList.innerHTML = '';
                    bonusList.innerHTML = '';

                    let employeeSalary = 0;
                    let workedSundayMorning = false;
                    let workedSundayNight = false;

                    card.querySelectorAll('.shift-item').forEach(item => {
                        const checkbox = item.querySelector('.shift-checkbox');
                        if (checkbox.checked) {
                            const hours = parseFloat(item.querySelector('.shift-hours').value) || 0;
                            const shiftValue = hours * hourlyRate;
                            employeeSalary += shiftValue;
                            if (checkbox.dataset.shift === 'domingo_manha') workedSundayMorning = true;
                            if (checkbox.dataset.shift === 'domingo_noite') workedSundayNight = true;

                            const shiftLabel = item.querySelector('.shift-label-text').textContent;
                            const li = document.createElement('li');
                            li.textContent = `${shiftLabel}: ${formatCurrency(shiftValue)} (por ${hours} horas)`;
                            shiftsList.appendChild(li);
                        }
                    });

                    const dobradinhaCheckbox = card.querySelector('.bonus-dobradinha-checkbox');
                    const isDobradinhaApplicable = workedSundayMorning && workedSundayNight;
                    dobradinhaCheckbox.disabled = !isDobradinhaApplicable;
                    if (!isDobradinhaApplicable) dobradinhaCheckbox.checked = false;
                    
                    let bonusDobradinha = dobradinhaCheckbox.checked ? BONUS_DOBRADINHA_VALUE : 0;
                    card.querySelector('[data-bonus="dobradinha"]').classList.toggle('bg-green-100', dobradinhaCheckbox.checked);
                    
                    if (dobradinhaCheckbox.checked) {
                        const li = document.createElement('li');
                        li.textContent = `Dobradinha: ${formatCurrency(BONUS_DOBRADINHA_VALUE)}`;
                        bonusList.appendChild(li);
                    }

                    let eventTotal = 0;
                    card.querySelectorAll('.event-item').forEach(eventItem => {
                        const eventCheckbox = eventItem.querySelector('.event-checkbox');
                        let calculatedEventValue = 0;
                        
                        if (eventCheckbox.checked) {
                            const typeSelector = eventItem.querySelector('.event-type-selector');
                            const eventHours = parseFloat(eventItem.querySelector('.event-hours').value) || 0;
                            let specificRate = 0;

                            if (typeSelector.value === 'hours') {
                                calculatedEventValue = eventHours * hourlyRate;
                            } else if (typeSelector.value === 'fixed') {
                                calculatedEventValue = parseCurrency(eventItem.querySelector('.event-fixed-value').value);
                            } else if (typeSelector.value === 'hours_specific') {
                                specificRate = parseCurrency(eventItem.querySelector('.event-specific-rate').value);
                                calculatedEventValue = eventHours * specificRate;
                            }
                            eventTotal += calculatedEventValue;

                            if(calculatedEventValue > 0) {
                                const eventName = eventItem.querySelector('.event-name').value || 'Adicional sem nome';
                                const li = document.createElement('li');
                                if((typeSelector.value === 'hours' || typeSelector.value === 'hours_specific') && eventHours > 0) {
                                    const rateDetail = typeSelector.value === 'hours_specific' ? ` @ ${formatCurrency(specificRate)}/h` : '';
                                    li.textContent = `${eventName}: ${formatCurrency(calculatedEventValue)} (${eventHours}h${rateDetail})`;
                                } else {
                                    li.textContent = `${eventName}: ${formatCurrency(calculatedEventValue)}`;
                                }
                                eventsList.appendChild(li);
                            }
                        }
                        eventItem.querySelector('.event-calculated-value').textContent = formatCurrency(calculatedEventValue);
                    });

                    const totalEmployeePay = employeeSalary + bonusDobradinha + eventTotal;
                    grandTotal += totalEmployeePay;
                    card.querySelector('.employee-total').textContent = formatCurrency(totalEmployeePay);

                    shiftsBreakdownContainer.classList.toggle('hidden', shiftsList.children.length === 0);
                    eventsBreakdownContainer.classList.toggle('hidden', eventsList.children.length === 0);
                    bonusBreakdownContainer.classList.toggle('hidden', bonusList.children.length === 0);
                });

                totalCostEl.textContent = formatCurrency(grandTotal);
                saveData();
            };

            const generateHoleriteText = (cardDetails) => {
                const card = cardDetails.querySelector('.employee-content');
                const employeeName = cardDetails.querySelector('.employee-name').value || 'Freelancer';
                const totalValue = card.querySelector('.employee-total').textContent;
                
                const shiftsBreakdown = card.querySelector('.shifts-breakdown-list').innerHTML;
                const eventsBreakdown = card.querySelector('.events-breakdown-list').innerHTML;
                const bonusBreakdown = card.querySelector('.bonus-breakdown-list').innerHTML;

                let text = `Olá, ${employeeName}! Tudo bem?\n\n`;
                text += `Segue o demonstrativo dos seus pagamentos para esta semana.\n\n`;

                if (shiftsBreakdown) {
                    text += `* Turnos Trabalhados:\n`;
                    card.querySelectorAll('.shifts-breakdown-list li').forEach(li => {
                        text += `  - ${li.textContent}\n`;
                    });
                }
                
                if (eventsBreakdown) {
                    text += `\n* Eventos / Adicionais:\n`;
                     card.querySelectorAll('.events-breakdown-list li').forEach(li => {
                        text += `  - ${li.textContent}\n`;
                    });
                }

                if (bonusBreakdown) {
                    text += `\n* Bônus:\n`;
                    card.querySelectorAll('.bonus-breakdown-list li').forEach(li => {
                        text += `  - ${li.textContent}\n`;
                    });
                }

                text += `\n--------------------------------\n`;
                text += `VALOR TOTAL A RECEBER: ${totalValue}\n\n`;
                text += `Muito obrigado pela sua dedicação e pelo excelente trabalho!\n\n`;
                text += `Abraços,\nRuth - Paz Coffee Shop`;

                return text;
            };

            const openModal = (modal) => {
                modal.classList.remove('pointer-events-none', 'opacity-0');
            };

            const closeModal = (modal) => {
                modal.classList.add('pointer-events-none', 'opacity-0');
            };

            document.querySelectorAll('.modal-close-btn, .modal-overlay').forEach(el => {
                el.addEventListener('click', () => {
                    closeModal(holeriteModal);
                    closeModal(deleteConfirmModal);
                });
            });
            
            copyHoleriteBtn.addEventListener('click', () => {
                holeriteTextarea.select();
                document.execCommand('copy');
                copyHoleriteBtn.textContent = 'Copiado!';
                copyHoleriteBtn.classList.remove('bg-blue-500', 'hover:bg-blue-700');
                copyHoleriteBtn.classList.add('bg-green-500');
            });

            confirmDeleteBtn.addEventListener('click', () => {
                if(cardToDelete) {
                    cardToDelete.remove();
                    calculateAll();
                }
                closeModal(deleteConfirmModal);
            });

            const addEvent = (eventList, data = {}) => {
                const eventItem = document.createElement('div');
                // --- EVENT ITEM LAYOUT UPDATED ---
                eventItem.className = 'event-item flex flex-col gap-2 p-3 border rounded-lg bg-gray-50';
                eventItem.innerHTML = `
                    <div class="flex items-center gap-2 w-full">
                        <input type="checkbox" class="event-checkbox h-5 w-5 text-blue-600 rounded focus:ring-blue-500 flex-shrink-0 mt-1 self-start">
                        <div class="flex-grow">
                            <input type="text" placeholder="Nome do Evento/Adicional" class="event-name w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                        </div>
                        <button class="remove-event-btn p-2 rounded-full hover:bg-red-100 text-red-500 hover:text-red-700 flex items-center justify-center self-start" title="Excluir Evento">
                            <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
                            </svg>
                        </button>
                    </div>
                    <div class="flex items-center flex-wrap gap-y-2 w-full">
                        <div class="flex items-center flex-wrap gap-x-4 gap-y-2 flex-grow">
                            <select class="event-type-selector bg-white border border-gray-300 rounded-lg p-2 flex-shrink-0">
                                <option value="hours">Horas (Taxa Padrão)</option>
                                <option value="hours_specific">Horas (Taxa Específica)</option>
                                <option value="fixed">Valor Fixo</option>
                            </select>
                            
                            <div class="event-input-container flex items-center flex-wrap gap-x-2 gap-y-1 justify-start">
                                <div class="event-hours-input-wrapper flex items-center gap-1">
                                    <input type="number" class="event-hours w-20 p-2 text-right border border-gray-300 rounded-lg" placeholder="0" step="0.5">
                                    <span class="text-sm text-gray-500">hrs</span>
                                </div>
                                
                                <div class="event-specific-rate-wrapper hidden flex items-center gap-1">
                                    <span class="text-sm text-gray-500">@</span>
                                    <input type="text" data-type="currency" class="event-specific-rate w-24 p-2 text-right border border-gray-300 rounded-lg" placeholder="R$ 0,00">
                                </div>

                                <div class="event-fixed-value-input-wrapper hidden flex items-center gap-1">
                                    <input type="text" data-type="currency" class="event-fixed-value w-24 p-2 text-right border border-gray-300 rounded-lg" placeholder="R$ 0,00">
                                </div>
                            </div>
                        </div>

                        <div class="flex items-center gap-2 flex-shrink-0 ml-auto">
                             <span class="text-gray-500">=</span>
                             <span class="event-calculated-value w-24 text-right font-semibold text-blue-600 text-lg">R$ 0,00</span>
                        </div>
                    </div>
                `;
                eventList.appendChild(eventItem);
                
                const eventCheckbox = eventItem.querySelector('.event-checkbox');
                const eventNameInput = eventItem.querySelector('.event-name');
                const typeSelector = eventItem.querySelector('.event-type-selector');
                const hoursInput = eventItem.querySelector('.event-hours');
                const fixedValueInput = eventItem.querySelector('.event-fixed-value');
                const specificRateInput = eventItem.querySelector('.event-specific-rate');

                const hoursWrapper = eventItem.querySelector('.event-hours-input-wrapper');
                const fixedWrapper = eventItem.querySelector('.event-fixed-value-input-wrapper');
                const specificWrapper = eventItem.querySelector('.event-specific-rate-wrapper');

                if (data && Object.keys(data).length > 0) {
                    eventNameInput.value = data.name || '';
                    typeSelector.value = data.type || 'hours';
                    hoursInput.value = data.hours || 0;
                    fixedValueInput.value = data.fixedValue || 'R$ 0,00';
                    specificRateInput.value = data.specificRate || 'R$ 0,00';
                    eventCheckbox.checked = data.checked !== false;
                } else {
                     eventCheckbox.checked = true;
                }
                
                const inputs = eventItem.querySelectorAll('input:not(.event-checkbox), select');

                const setEventState = (isChecked) => {
                    inputs.forEach(input => input.disabled = !isChecked);
                    eventItem.classList.toggle('disabled', !isChecked);
                };
                
                setEventState(eventCheckbox.checked);

                eventCheckbox.addEventListener('change', () => {
                    setEventState(eventCheckbox.checked);
                    calculateAll();
                });

                typeSelector.addEventListener('change', () => {
                    const isHours = typeSelector.value === 'hours';
                    const isHoursSpecific = typeSelector.value === 'hours_specific';
                    const isFixed = typeSelector.value === 'fixed';

                    hoursWrapper.classList.toggle('hidden', !isHours && !isHoursSpecific);
                    specificWrapper.classList.toggle('hidden', !isHoursSpecific);
                    fixedWrapper.classList.toggle('hidden', !isFixed);
                    
                    calculateAll();
                });
                typeSelector.dispatchEvent(new Event('change'));

                eventItem.querySelectorAll('input, select').forEach(input => input.addEventListener('input', calculateAll));
                
                // *** CORREÇÃO: Aplicando a nova lógica de formatação de moeda. ***
                eventItem.querySelectorAll('input[data-type="currency"]').forEach(setupCurrencyHandlers);

                eventItem.querySelector('.remove-event-btn').addEventListener('click', () => {
                    eventItem.remove();
                    calculateAll();
                });

                if(!data.name) eventNameInput.focus();
            };
            
            const addEmployee = (data = {}) => {
                const newEmployeeDetails = employeeTemplate.content.cloneNode(true);
                const cardDetails = newEmployeeDetails.querySelector('.employee-card-details');
                const cardContent = newEmployeeDetails.querySelector('.employee-content');
                
                cardDetails.dataset.id = data.id || `employee-${Date.now()}`;
                cardDetails.open = data.open !== false; 
                cardDetails.querySelector('.employee-name').value = data.name || '';
                
                const hourlyRateInput = cardContent.querySelector('.hourly-rate');
                hourlyRateInput.value = data.hourlyRate || 'R$ 15,00';
                
                cardContent.querySelector('.bonus-dobradinha-checkbox').checked = data.bonusDobradinha || false;

                const shiftsContainer = cardContent.querySelector('.shifts-container');
                const shiftsData = data.shifts || [];

                SHIFTS.forEach(shift => {
                    const savedShift = shiftsData.find(s => s.id === shift.id) || {};
                    const shiftEl = document.createElement('div');
                    shiftEl.className = 'shift-item flex items-center justify-between p-2 rounded-lg sm:max-w-xs';
                    shiftEl.innerHTML = `
                        <label class="flex items-center space-x-2 cursor-pointer">
                            <input type="checkbox" class="shift-checkbox h-5 w-5 text-orange-600 rounded focus:ring-orange-500" data-shift="${shift.id}">
                            <span class="shift-label-text">${shift.label}</span>
                        </label>
                        <div class="flex items-center gap-1">
                            <input type="number" class="shift-hours w-16 p-1 text-right border border-gray-300 rounded-md" step="0.5">
                            <span class="text-xs text-gray-500">hrs</span>
                        </div>
                    `;
                    shiftsContainer.appendChild(shiftEl);

                    const checkbox = shiftEl.querySelector('.shift-checkbox');
                    const hoursInput = shiftEl.querySelector('.shift-hours');
                    
                    hoursInput.dataset.lastValue = savedShift.hours || shift.hours; 
                    checkbox.checked = savedShift.checked || false;

                    const setShiftState = (isChecked) => {
                        hoursInput.disabled = !isChecked;
                        shiftEl.classList.toggle('bg-orange-50', isChecked);
                        shiftEl.classList.toggle('opacity-60', !isChecked);
                        if(isChecked) {
                            hoursInput.value = hoursInput.dataset.lastValue;
                        } else {
                            hoursInput.value = 0;
                        }
                    };
                    
                    hoursInput.addEventListener('input', () => {
                        if (hoursInput.value && !isNaN(parseFloat(hoursInput.value))) {
                            hoursInput.dataset.lastValue = hoursInput.value;
                        }
                    });

                    checkbox.addEventListener('change', () => {
                        setShiftState(checkbox.checked);
                        calculateAll();
                    });
                    setShiftState(checkbox.checked);
                });

                employeeContainer.appendChild(newEmployeeDetails);
                const justAddedCard = employeeContainer.lastElementChild;

                const eventList = justAddedCard.querySelector('.event-list');
                if (data.events && data.events.length) {
                    data.events.forEach(eventData => addEvent(eventList, eventData));
                }
                
                // --- NEW MINIMIZE BUTTON LOGIC ---
                const summary = justAddedCard.querySelector('.employee-summary');
                const minimizeBtn = justAddedCard.querySelector('.minimize-btn');
                
                const iconMinimize = `<svg class="w-5 h-5 text-gray-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M4.5 15.75l7.5-7.5 7.5 7.5" /></svg>`;
                const iconExpand = `<svg class="w-5 h-5 text-gray-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M19.5 8.25l-7.5 7.5-7.5-7.5" /></svg>`;

                const updateMinimizeIcon = () => {
                    minimizeBtn.innerHTML = justAddedCard.open ? iconMinimize : iconExpand;
                };

                summary.addEventListener('click', (e) => {
                    if (!e.target.closest('button, input')) {
                        e.preventDefault();
                    }
                });
                
                minimizeBtn.addEventListener('click', (e) => {
                    e.preventDefault();
                    justAddedCard.open = !justAddedCard.open;
                    updateMinimizeIcon();
                });

                updateMinimizeIcon();
                // --- END OF NEW MINIMIZE LOGIC ---

                justAddedCard.querySelectorAll('input, select, details').forEach(input => {
                    input.addEventListener('input', calculateAll);
                    input.addEventListener('change', calculateAll);
                    input.addEventListener('toggle', saveData); 
                });
                
                // *** CORREÇÃO: Aplicando a nova lógica de formatação de moeda. ***
                justAddedCard.querySelectorAll('input[data-type="currency"]').forEach(setupCurrencyHandlers);
                
                const removeBtn = justAddedCard.querySelector('.remove-employee');
                removeBtn.addEventListener('click', (e) => {
                    e.preventDefault();
                    cardToDelete = justAddedCard;
                    const name = justAddedCard.querySelector('.employee-name').value || 'este funcionário';
                    deleteConfirmText.textContent = `Tem certeza que quer excluir ${name}?`;
                    openModal(deleteConfirmModal);
                });

                justAddedCard.querySelector('.reset-btn').addEventListener('click', (e) => {
                    e.preventDefault();
                    justAddedCard.querySelectorAll('.shift-checkbox, .bonus-dobradinha-checkbox').forEach(cb => {
                        cb.checked = false;
                        cb.dispatchEvent(new Event('change'));
                    });
                    eventList.innerHTML = '';
                    calculateAll();
                });
                
                justAddedCard.querySelector('.add-event-btn').addEventListener('click', (e) => {
                    e.preventDefault();
                    addEvent(eventList);
                });
                
                justAddedCard.querySelector('.generate-holerite-btn').addEventListener('click', () => {
                    holeriteTextarea.value = generateHoleriteText(justAddedCard);
                    openModal(holeriteModal);
                    copyHoleriteBtn.textContent = 'Copiar Texto';
                    copyHoleriteBtn.classList.remove('bg-green-500');
                    copyHoleriteBtn.classList.add('bg-blue-500', 'hover:bg-blue-700');
                });
                
                if (!data.name) {
                    justAddedCard.querySelector('.employee-name').focus();
                }
            };
            
            const loadData = () => {
                const data = JSON.parse(localStorage.getItem(STORAGE_KEY));
                if (data && data.length) {
                    data.forEach(employeeData => addEmployee(employeeData));
                } else {
                    addEmployee();
                }
                calculateAll();
            };

            addEmployeeButton.addEventListener('click', () => addEmployee());
            
            loadData();
        });
    </script>
</body>
</html>
```

As principais alterações foram:

1.  **Nova Lógica de Formatação:** A função `formatCurrencyInput` foi removida. Em seu lugar, criei uma nova função `setupCurrencyHandlers` que aplica a formatação de um jeito mais intuitivo.
2.  **Edição Simplificada:** Agora, ao clicar em um campo de valor (como "Valor/Hora" ou nos valores de eventos), a formatação "R$" some e você vê um número simples (ex: `15,00`), o que facilita a edição.
3.  **Formatação Automática ao Sair:** Ao clicar fora do campo, o valor que você digitou será automaticamente formatado para o padrão de moeda (ex: `15,00` vira `R$ 15,00`).
4.  **Cálculos Corretos:** Com essa mudança, os cálculos agora usarão os valores exatos que você digitar, resolvendo a inconsistência que você relatou.

Espero que essa solução deixe a calculadora mais fácil e agradável de usar! Se tiver qualquer outra dúvida, é só me cham
